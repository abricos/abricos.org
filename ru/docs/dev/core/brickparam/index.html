<!--[*]
[tt=content][/tt]

[mod=sitemap]regmenuitem|title=Параметры кирпича,buildmetavars[/mod]
[*]-->
<h3>Параметры кирпича</h3>
<p>
	В текущей версии платформы Абрикос определены следующие типы параметров:
</p> 
<ul>
	<li>
		<b><i><a href="#bkvar">bkvar</a></i></b> - локальная переменная кирпича;
	</li>
	<li>
		<b><i>var</i></b> - глобальная переменная кирпича;
	</li>
	<li>
		<b><i>p</i></b> - параметр вызова кирпича;
	</li>
	<li>
		<b><i>ph</i></b> - фраза кирпича, которая синхронизируется с БД;
	</li>
	<li>
		<b><i>mjs</i></b> - JS-компонент модуля, который будет запрошен на выполнение после 
		инициализации страницы в интернет-браузере клиента;
	</li>
	<li>
		<b><i>mcss</i></b> - CSS-файл модуля;
	</li>
	<li>
		<b><i>js</i></b> - JS-файл, который будет включен в список дополнительных JS-файлов 
		собираемой страницы;
	</li>
	<li>
		<b><i>css</i></b> - CSS-файл, который будет включен в список подключаемых CSS-стилей 
		собираемой страницы;
	</li>
	<li>
		<b><i>tt</i></b> - шаблон, используется только стартовых кирпичах;
	</li>
	<li>
		<b><i>script</i></b> - PHP-скрипт кирпича, который будет вызван в процессе компиляции кирпича;
	</li>
</ul>

<a name="bkvar"></a>
<h4>Локальная переменная - bkvar</h4>
<p>
	 Параметр bkvar - определяет локальную переменную кирпича. 
</p>
<p>
	Объявления в заголовке кирпича: 
</p>
<pre class="prettyprint"><code>[bkvar=myvar]Default value[/bkvar]</code></pre>
<p>
	Вывод результата в теле кирпича:  
</p>
<pre class="prettyprint"><code>[bkvar]myvar[/bkvar]</code></pre>
<h5>Область применения bkvar</h5>
<p>
	 Область применения параметра <i>bkvar</i> обширна, но основна задача переменной - это 
	 описание частей интерфейса в кирпиче с последующим применением.   
</p>
<p>
	 Допустим, необходимо построить следующий элемент интерфейса, который будет 
	 строить список неких записей из БД: 
</p>
<pre class="prettyprint"><code class="html">
 &lt;ul&gt;
  &lt;li&gt;Запись 1&lt;/li&gt;
  &lt;li&gt;Запись 2&lt;/li&gt;
  &lt;li&gt;...&lt;/li&gt;
  &lt;li&gt;Запись N&lt;/li&gt;
 &lt;/ul&gt;
	
</code></pre>
<p>
	Для реализации необходимо создать кирпич и скрипт управления, которым будет обработан 
	этот кирпич в момент его сборки. <br >
	Кирпич mylist.html:
</p>
<pre class="prettyprint"><code class="html">&lt;!--[*]
[script]mylist.php[/script]
[bkvar=row]&lt;li&gt;{v#item}&lt;/li&gt;[/bkvar]
[bkvar=result][/bkvar]
[*]--&gt;
&lt;ul&gt;
  [bkvar]result[/bkvar]
&lt;/ul&gt;</code></pre>
<p>
	где, <br />
	<i>[bkvar=row]...[/bkvar]</i> - локальная переменная, которая будет содержать часть 
	элемента интерфейса, <br />
	<i>[bkvar=result][/bkvar]</i> - локальная переменная, в которую будет занесен результат 
	построения списка в php-скрипте <i>mylist.php</i>, <br />
	<i>[script]mylist.php[/script]</i> - имя php-скрипта, который будет вызван в процессе сборки кирпича.
</p>
<p>
	Скрипт mylist.php:
</p>
<pre class="prettyprint"><code class="php">&lt;?php
// получить объект кирпича который вызвал этот скрипт
$brick = Brick::$builder-&gt;brick;

// получить указатель на записи из таблицы cms_list по SQL запросу 'SELECT * FROM cms_list'
$rows = Brick::$db-&gt;query_read('SELECT * FROM cms_list');

//объявить пустую строковую переменную $list
$list = "";

// прочитать каждую запись из таблицы в переменную $r, где $r - будет 
// иметь тип "массив", указателем в котором будет имя поля из таблицы
while (($r = Brick::$db-&gt;fetch_array($rows))){

  // взять значении из локальной переменной кирпича row и заменить в 
  // нем идентификатор item на значение из строки выбранного запроса, 
  // результат добавить к переменной $list
  $list .= Brick::ReplaceVar($brick-&gt;param-&gt;var['row'], 'item', $r['field_item']);
}
$brick-&gt;param-&gt;var['result'] = $list;
?&gt;
</code></pre>
<p>
	В результате, когда ядро платформы будет компилировать кирпич <i>mylist</i> будет вызван 
	скрипт <i>mylist.php</i>, который сделает выборку из БД, построит список используя 
	элемент шаблона взятый из локальной переменной <i>row</i> и результат занесет в
	локальную переменную <i>result</i>, значение которой будет занесено в тело кирпича в то
	место, где объявлен вывод значения этой переменной - <i>[bkvar]result[/bkvar]</i>.
	 
</p>